<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaLiga Predictor - An√°lisis IA</title>
    <meta name="description" content="An√°lisis con IA de los partidos de LaLiga">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="m-0 p-0">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Componentes de iconos simplificados
        const TrendingUp = ({ className, size }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Shield = ({ className, size }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
        );

        const Target = ({ className, size }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
            </svg>
        );

        const LaLigaPredictor = () => {
          // Estado de navegaci√≥n
          const [currentView, setCurrentView] = useState('home'); // 'home' o 'league'
          const [selectedLeague, setSelectedLeague] = useState(null);
          
          const [matchdayNumber, setMatchdayNumber] = useState(null);
          const [dateRange, setDateRange] = useState('');
          const [matches, setMatches] = useState([]);
          const [selectedMatch, setSelectedMatch] = useState(null);
          const [analysis, setAnalysis] = useState(null);
          const [loading, setLoading] = useState(false);
          const [standings, setStandings] = useState({});
          const [loadingData, setLoadingData] = useState(true);

          // Obtener clasificaci√≥n y pr√≥xima jornada (solo cuando se selecciona liga)
          useEffect(() => {
            if (currentView === 'league' && selectedLeague) {
              const fetchData = async () => {
                setLoadingData(true);
                try {
                  // Cargar clasificaci√≥n
                  const standingsRes = await fetch('/api/standings');
                  if (standingsRes.ok) {
                    const standingsData = await standingsRes.json();
                    if (standingsData.success) {
                      setStandings(standingsData.standings);
                      console.log('‚úÖ Clasificaci√≥n cargada:', Object.keys(standingsData.standings).length, 'equipos');
                    }
                  }

                  // Cargar pr√≥xima jornada
                  const matchdayRes = await fetch('/api/next-matchday');
                  if (matchdayRes.ok) {
                    const matchdayData = await matchdayRes.json();
                    if (matchdayData.success) {
                      setMatchdayNumber(matchdayData.matchday);
                      setDateRange(matchdayData.dateRange);
                      setMatches(matchdayData.matches);
                      console.log(`‚úÖ Jornada ${matchdayData.matchday} cargada:`, matchdayData.matches.length, 'partidos');
                    }
                  }
                } catch (error) {
                  console.error('‚ùå Error cargando datos:', error);
                } finally {
                  setLoadingData(false);
                }
              };

              fetchData();
            }
          }, [currentView, selectedLeague]);

          // Funci√≥n para seleccionar liga
          const selectLeague = (leagueName) => {
            setSelectedLeague(leagueName);
            setCurrentView('league');
          };

          // Funci√≥n auxiliar para obtener datos del equipo
          const getTeamData = (teamName) => {
            return standings[teamName] || { position: '?', points: 0 };
          };

          const analyzeMatch = async (match) => {
            setSelectedMatch(match);
            setLoading(true);
            setAnalysis(null);

            try {
              const homeData = getTeamData(match.home);
              const awayData = getTeamData(match.away);

              // Obtener estad√≠sticas detalladas de ambos equipos
              const homeStats = await fetch(`/api/team-stats/${match.home}`).then(r => r.json()).catch(() => null);
              const awayStats = await fetch(`/api/team-stats/${match.away}`).then(r => r.json()).catch(() => null);

              // NUEVO: Obtener predicciones de goles con Poisson
              const goalPrediction = await fetch(`/api/goal-prediction/${match.home}/${match.away}`).then(r => r.json()).catch(() => null);
              console.log('üìä Predicci√≥n Poisson recibida:', goalPrediction);

              const systemPrompt = `Act√∫a como un modelo de predicci√≥n de resultados de f√∫tbol basado en an√°lisis estad√≠stico y probabil√≠stico, no como un aficionado.

Tu objetivo es predecir partidos de LaLiga utilizando datos hist√≥ricos y contexto reciente, ofreciendo probabilidades basadas en datos reales.

NO te bases en nombres grandes, favoritismos medi√°ticos ni intuiciones subjetivas. Usa SOLO los datos proporcionados.

Utiliza un tono t√©cnico, neutral y realista.`;

              // Construir descripci√≥n de forma reciente
              let formDescription = '';
              
              if (homeStats?.success) {
                const hf = homeStats.recentForm;
                formDescription += `\n${match.home} - √öltimos 5 partidos: ${hf.wins}V/${hf.draws}E/${hf.losses}D, ${hf.goalsFor} goles a favor, ${hf.goalsAgainst} en contra`;
                const hfh = homeStats.homeForm;
                formDescription += `\n  Como local: ${hfh.wins}V/${hfh.draws}E/${hfh.losses}D en √∫ltimos partidos en casa`;
              }
              
              if (awayStats?.success) {
                const af = awayStats.recentForm;
                formDescription += `\n\n${match.away} - √öltimos 5 partidos: ${af.wins}V/${af.draws}E/${af.losses}D, ${af.goalsFor} goles a favor, ${af.goalsAgainst} en contra`;
                const afa = awayStats.awayForm;
                formDescription += `\n  Como visitante: ${afa.wins}V/${afa.draws}E/${afa.losses}D en √∫ltimos partidos fuera`;
              }

              const userPrompt = `Analiza este partido de LaLiga Jornada ${matchdayNumber}:

${match.home} (${homeData.position}¬∫ posici√≥n, ${homeData.points} puntos) vs ${match.away} (${awayData.position}¬∫ posici√≥n, ${awayData.points} puntos)

DATOS REALES DE FORMA RECIENTE:${formDescription}

FACTORES A CONSIDERAR (en orden de importancia):
1. Forma reciente de ambos equipos (√∫ltimos 5 partidos) - datos REALES proporcionados arriba
2. Rendimiento como local vs visitante - datos REALES proporcionados arriba  
3. Posici√≥n y puntos en la clasificaci√≥n actual
4. Diferencia de goles y rendimiento general
5. Factor campo (estad√≠sticamente ~45% victorias locales en LaLiga)

Responde SOLO con un objeto JSON v√°lido (sin texto adicional, sin markdown, sin comentarios):
{
  "winHome": 45,
  "draw": 25,
  "winAway": 30,
  "over05": 85,
  "over15": 70,
  "over25": 45,
  "over35": 20,
  "btts": 55,
  "reasoning": {
    "homeAdvantages": ["Ventaja 1 basada en datos", "Ventaja 2 basada en datos"],
    "awayAdvantages": ["Ventaja 1 basada en datos", "Ventaja 2 basada en datos"],
    "keyFactors": ["Factor clave 1", "Factor clave 2", "Factor clave 3"]
  }
}

IMPORTANTE para las probabilidades de goles:
- over05: % de que haya M√ÅS de 0.5 goles (al menos 1 gol en el partido)
- over15: % de que haya M√ÅS de 1.5 goles (al menos 2 goles en total)
- over25: % de que haya M√ÅS de 2.5 goles (al menos 3 goles en total)
- over35: % de que haya M√ÅS de 3.5 goles (al menos 4 goles en total)
- btts: % de que AMBOS equipos marquen

Calcula estas probabilidades bas√°ndote en:
- Promedio de goles totales en los √∫ltimos partidos de ambos equipos
- Goles a favor y en contra de cada equipo
- Si un equipo tiene muchos goles a favor y el otro tambi√©n, aumenta over25, over35 y btts
- Si ambos tienen pocas goles en contra (defensas s√≥lidas), reduce over25 y over35
- Si uno marca mucho pero el otro casi no recibe goles, reduce btts

Las probabilidades de resultado (winHome/draw/winAway) deben sumar exactamente 100.
S√© realista y objetivo bas√°ndote en los datos estad√≠sticos proporcionados.
IMPORTANTE: Esto es una predicci√≥n estad√≠stica, no garantiza el resultado real.`;

              console.log('üìä Datos enviados a la IA:', { homeStats, awayStats });

              // Llamar al proxy del servidor (evita CORS)
              const response = await fetch("/api/analyze", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({
                  system: systemPrompt,
                  messages: [
                    { 
                      role: "user", 
                      content: userPrompt
                    }
                  ]
                })
              });

              if (!response.ok) {
                throw new Error(`API error: ${response.status}`);
              }

              const data = await response.json();
              
              if (data.content && data.content[0] && data.content[0].text) {
                let aiText = data.content[0].text.trim();
                aiText = aiText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                
                const jsonMatch = aiText.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                  const aiAnalysis = JSON.parse(jsonMatch[0]);
                  
                  const total = aiAnalysis.winHome + aiAnalysis.draw + aiAnalysis.winAway;
                  if (Math.abs(total - 100) > 1) {
                    const factor = 100 / total;
                    aiAnalysis.winHome = Math.round(aiAnalysis.winHome * factor);
                    aiAnalysis.draw = Math.round(aiAnalysis.draw * factor);
                    aiAnalysis.winAway = 100 - aiAnalysis.winHome - aiAnalysis.draw;
                  }
                  
                  // USAR predicciones de Poisson si est√°n disponibles (M√ÅS PRECISAS)
                  if (goalPrediction?.success) {
                    console.log('‚úÖ Usando probabilidades de Poisson (m√°s precisas)');
                    aiAnalysis.over05 = goalPrediction.probabilities.over05;
                    aiAnalysis.over15 = goalPrediction.probabilities.over15;
                    aiAnalysis.over25 = goalPrediction.probabilities.over25;
                    aiAnalysis.over35 = goalPrediction.probabilities.over35;
                    aiAnalysis.btts = goalPrediction.probabilities.btts;
                    aiAnalysis.expectedGoals = goalPrediction.expectedGoals;
                    aiAnalysis.poissonData = goalPrediction;
                    
                    // NUEVO: Usar probabilidades de victoria calculadas con Poisson
                    if (goalPrediction.matchProbabilities) {
                      console.log('‚úÖ Usando probabilidades de victoria Poisson (consistentes con goles)');
                      aiAnalysis.winHome = goalPrediction.matchProbabilities.winHome;
                      aiAnalysis.draw = goalPrediction.matchProbabilities.draw;
                      aiAnalysis.winAway = goalPrediction.matchProbabilities.winAway;
                    }
                  }
                  
                  // IMPORTANTE: Si el servidor envi√≥ reasoning basado en datos reales, usarlo
                  // Esto evita textos incorrectos generados por la IA
                  if (goalPrediction?.reasoning) {
                    console.log('‚úÖ Usando reasoning del servidor (basado en datos reales, sin errores IA)');
                    aiAnalysis.reasoning = goalPrediction.reasoning;
                  }
                  
                  // A√±adir datos de forma reciente al an√°lisis
                  aiAnalysis.homeStats = homeStats;
                  aiAnalysis.awayStats = awayStats;
                  
                  setAnalysis(aiAnalysis);
                } else {
                  throw new Error("No se pudo extraer JSON v√°lido");
                }
              } else {
                throw new Error("Respuesta de API inv√°lida");
              }
            } catch (error) {
              console.error("Error completo:", error);
              
              const homeData = getTeamData(match.home);
              const awayData = getTeamData(match.away);
              const diffPoints = homeData.points - awayData.points;
              
              let winHome, draw, winAway;
              
              if (diffPoints > 15) {
                winHome = 65;
                draw = 20;
                winAway = 15;
              } else if (diffPoints > 5) {
                winHome = 50;
                draw = 25;
                winAway = 25;
              } else if (diffPoints < -15) {
                winHome = 15;
                draw = 20;
                winAway = 65;
              } else if (diffPoints < -5) {
                winHome = 25;
                draw = 25;
                winAway = 50;
              } else {
                winHome = 40;
                draw = 30;
                winAway = 30;
              }
              
              setAnalysis({
                winHome,
                draw,
                winAway,
                reasoning: {
                  homeAdvantages: [
                    "Factor campo importante en LaLiga",
                    homeData.position < awayData.position ? "Mejor posici√≥n en la clasificaci√≥n" : "Necesidad de sumar en casa",
                    "Ventaja del apoyo de su afici√≥n"
                  ],
                  awayAdvantages: [
                    awayData.position < homeData.position ? "Superior clasificaci√≥n en la tabla" : "Menos presi√≥n jugando fuera",
                    awayData.points > homeData.points ? "Mayor n√∫mero de puntos acumulados" : "Posibilidad de sorprender",
                    "Experiencia en partidos dif√≠ciles"
                  ],
                  keyFactors: [
                    `Diferencia de ${Math.abs(diffPoints)} puntos en la clasificaci√≥n`,
                    `${match.home} est√° en posici√≥n ${homeData.position}¬™ mientras ${match.away} est√° ${awayData.position}¬∫`,
                    "El factor campo juega un papel crucial en LaLiga",
                    "La forma reciente de ambos equipos ser√° determinante"
                  ]
                }
              });
            } finally {
              setLoading(false);
            }
          };

          // Vista de inicio - Selecci√≥n de liga
          if (currentView === 'home') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6">
                <div className="max-w-6xl mx-auto">
                  <div className="text-center mb-12 pt-20">
                    <h1 className="text-6xl font-bold text-white mb-4">
                      ‚öΩ Predictor Deportivo IA
                    </h1>
                    <p className="text-purple-200 text-xl">An√°lisis de partidos con Inteligencia Artificial</p>
                    <p className="text-purple-300 text-sm mt-3">Selecciona una liga para comenzar</p>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-16">
                    {/* Tarjeta LaLiga */}
                    <div
                      onClick={() => selectLeague('laliga')}
                      className="group relative bg-gradient-to-br from-orange-500/20 to-red-600/20 backdrop-blur-md rounded-2xl p-8 hover:from-orange-500/30 hover:to-red-600/30 cursor-pointer transition-all transform hover:scale-105 border-2 border-orange-500/50 hover:border-orange-400 shadow-2xl"
                    >
                      <div className="absolute inset-0 bg-gradient-to-br from-orange-500/10 to-red-600/10 rounded-2xl blur-xl group-hover:blur-2xl transition-all"></div>
                      
                      <div className="relative">
                        <div className="text-center mb-4">
                          <div className="text-7xl mb-3">üá™üá∏</div>
                          <h2 className="text-3xl font-bold text-white mb-2">LaLiga</h2>
                          <p className="text-orange-200 text-sm">Liga Espa√±ola</p>
                        </div>
                        
                        <div className="bg-black/20 rounded-lg p-4 mb-4">
                          <p className="text-white text-sm text-center">
                            <span className="font-bold text-orange-300">‚úì</span> Predicciones con IA<br/>
                            <span className="font-bold text-orange-300">‚úì</span> Datos en tiempo real<br/>
                            <span className="font-bold text-orange-300">‚úì</span> Estad√≠sticas avanzadas
                          </p>
                        </div>
                        
                        <button className="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-3 rounded-lg hover:from-orange-600 hover:to-red-700 transition-all font-bold text-lg shadow-lg">
                          Entrar ‚Üí
                        </button>
                      </div>
                    </div>

                    {/* Tarjetas de otras ligas (pr√≥ximamente) */}
                    <div className="group relative bg-gradient-to-br from-gray-500/10 to-gray-600/10 backdrop-blur-md rounded-2xl p-8 border-2 border-gray-500/30 shadow-2xl opacity-50">
                      <div className="relative">
                        <div className="text-center mb-4">
                          <div className="text-7xl mb-3">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø</div>
                          <h2 className="text-3xl font-bold text-gray-300 mb-2">Premier League</h2>
                          <p className="text-gray-400 text-sm">Liga Inglesa</p>
                        </div>
                        
                        <div className="bg-black/20 rounded-lg p-4 mb-4">
                          <p className="text-gray-400 text-sm text-center font-semibold">
                            Pr√≥ximamente
                          </p>
                        </div>
                        
                        <button disabled className="w-full bg-gray-600 text-gray-300 py-3 rounded-lg font-bold text-lg cursor-not-allowed">
                          Pr√≥ximamente
                        </button>
                      </div>
                    </div>

                    <div className="group relative bg-gradient-to-br from-gray-500/10 to-gray-600/10 backdrop-blur-md rounded-2xl p-8 border-2 border-gray-500/30 shadow-2xl opacity-50">
                      <div className="relative">
                        <div className="text-center mb-4">
                          <div className="text-7xl mb-3">üáÆüáπ</div>
                          <h2 className="text-3xl font-bold text-gray-300 mb-2">Serie A</h2>
                          <p className="text-gray-400 text-sm">Liga Italiana</p>
                        </div>
                        
                        <div className="bg-black/20 rounded-lg p-4 mb-4">
                          <p className="text-gray-400 text-sm text-center font-semibold">
                            Pr√≥ximamente
                          </p>
                        </div>
                        
                        <button disabled className="w-full bg-gray-600 text-gray-300 py-3 rounded-lg font-bold text-lg cursor-not-allowed">
                          Pr√≥ximamente
                        </button>
                      </div>
                    </div>
                  </div>

                  <div className="text-center mt-16">
                    <p className="text-purple-300 text-sm">
                      üí° Predicciones basadas en an√°lisis estad√≠stico con inteligencia artificial
                    </p>
                  </div>
                </div>
              </div>
            );
          }

          // Vista de carga
          if (loadingData && currentView === 'league') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex items-center justify-center">
                <div className="text-center">
                  <div className="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-purple-400 mb-4"></div>
                  <p className="text-white text-xl">üîÑ Cargando pr√≥xima jornada...</p>
                </div>
              </div>
            );
          }

          // Vista de liga (partidos)
          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 p-6">
              <div className="max-w-7xl mx-auto">
                {/* Bot√≥n volver */}
                <button
                  onClick={() => setCurrentView('home')}
                  className="mb-6 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg transition-all flex items-center gap-2"
                >
                  ‚Üê Volver a ligas
                </button>

                <div className="text-center mb-8">
                  <h1 className="text-5xl font-bold text-white mb-2">
                    ‚öΩ LaLiga Jornada {matchdayNumber}
                  </h1>
                  <p className="text-purple-200 text-lg">An√°lisis con Inteligencia Artificial</p>
                  <p className="text-purple-300 text-sm mt-2">{dateRange}</p>
                  <p className="text-green-300 text-xs mt-2">‚úÖ Se actualiza autom√°ticamente al finalizar la jornada</p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                  {matches.map((match) => {
                    const homeData = getTeamData(match.home);
                    const awayData = getTeamData(match.away);
                    
                    return (
                      <div
                        key={match.id}
                        onClick={() => analyzeMatch(match)}
                        className="bg-white/10 backdrop-blur-md rounded-xl p-5 hover:bg-white/20 cursor-pointer transition-all transform hover:scale-105 border border-white/20"
                      >
                        <div className="text-purple-200 text-xs mb-3 font-semibold">
                          {match.date}
                        </div>
                        
                        <div className="flex justify-between items-center mb-2">
                          <span className="text-white font-bold text-lg">{match.home}</span>
                          <span className="bg-blue-500 text-white px-2 py-1 rounded text-xs">
                            {homeData.position}¬∫ - {homeData.points}pts
                          </span>
                        </div>

                        <div className="text-center text-purple-300 font-bold my-2">VS</div>

                        <div className="flex justify-between items-center">
                          <span className="text-white font-bold text-lg">{match.away}</span>
                          <span className="bg-purple-500 text-white px-2 py-1 rounded text-xs">
                            {awayData.position}¬∫ - {awayData.points}pts
                          </span>
                        </div>

                        <button className="w-full mt-4 bg-gradient-to-r from-purple-500 to-blue-500 text-white py-2 rounded-lg hover:from-purple-600 hover:to-blue-600 transition-all font-semibold">
                          ü§ñ Analizar con IA
                        </button>
                      </div>
                    );
                  })}
                </div>

                {selectedMatch && (
                  <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-8 border border-white/20">
                    <h2 className="text-3xl font-bold text-white mb-6 text-center">
                      {selectedMatch.home} vs {selectedMatch.away}
                    </h2>

                    {loading ? (
                      <div className="text-center py-12">
                        <div className="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-purple-400"></div>
                        <p className="text-purple-200 mt-4 text-lg">ü§ñ Analizando con IA...</p>
                        <p className="text-purple-300 text-sm mt-2">Evaluando estad√≠sticas y probabilidades</p>
                      </div>
                    ) : analysis ? (
                      <div className="space-y-6">
                        <div className="space-y-4">
                          <div>
                            <div className="flex justify-between mb-2">
                              <span className="text-white font-semibold">üè† Victoria {selectedMatch.home}</span>
                              <span className="text-green-400 font-bold text-xl">{analysis.winHome}%</span>
                            </div>
                            <div className="w-full bg-white/20 rounded-full h-8 overflow-hidden">
                              <div
                                className="bg-gradient-to-r from-green-400 to-green-600 h-8 rounded-full transition-all duration-1000 flex items-center justify-center"
                                style={{ width: `${analysis.winHome}%` }}
                              >
                                {analysis.winHome > 10 && <span className="text-white text-sm font-bold">{analysis.winHome}%</span>}
                              </div>
                            </div>
                          </div>

                          <div>
                            <div className="flex justify-between mb-2">
                              <span className="text-white font-semibold">ü§ù Empate</span>
                              <span className="text-yellow-400 font-bold text-xl">{analysis.draw}%</span>
                            </div>
                            <div className="w-full bg-white/20 rounded-full h-8 overflow-hidden">
                              <div
                                className="bg-gradient-to-r from-yellow-400 to-yellow-600 h-8 rounded-full transition-all duration-1000 flex items-center justify-center"
                                style={{ width: `${analysis.draw}%` }}
                              >
                                {analysis.draw > 10 && <span className="text-white text-sm font-bold">{analysis.draw}%</span>}
                              </div>
                            </div>
                          </div>

                          <div>
                            <div className="flex justify-between mb-2">
                              <span className="text-white font-semibold">‚úàÔ∏è Victoria {selectedMatch.away}</span>
                              <span className="text-blue-400 font-bold text-xl">{analysis.winAway}%</span>
                            </div>
                            <div className="w-full bg-white/20 rounded-full h-8 overflow-hidden">
                              <div
                                className="bg-gradient-to-r from-blue-400 to-blue-600 h-8 rounded-full transition-all duration-1000 flex items-center justify-center"
                                style={{ width: `${analysis.winAway}%` }}
                              >
                                {analysis.winAway > 10 && <span className="text-white text-sm font-bold">{analysis.winAway}%</span>}
                              </div>
                            </div>
                          </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6 mt-8">
                          <div className="bg-green-900/30 rounded-xl p-5 border border-green-500/30">
                            <div className="flex items-center gap-2 mb-3">
                              <TrendingUp className="text-green-400" size={24} />
                              <h3 className="text-green-300 font-bold text-lg">Ventajas {selectedMatch.home}</h3>
                            </div>
                            <ul className="space-y-2">
                              {analysis.reasoning.homeAdvantages.map((adv, idx) => (
                                <li key={idx} className="text-green-100 flex items-start gap-2">
                                  <span className="text-green-400 mt-1">‚úì</span>
                                  <span>{adv}</span>
                                </li>
                              ))}
                            </ul>
                          </div>

                          <div className="bg-blue-900/30 rounded-xl p-5 border border-blue-500/30">
                            <div className="flex items-center gap-2 mb-3">
                              <Shield className="text-blue-400" size={24} />
                              <h3 className="text-blue-300 font-bold text-lg">Ventajas {selectedMatch.away}</h3>
                            </div>
                            <ul className="space-y-2">
                              {analysis.reasoning.awayAdvantages.map((adv, idx) => (
                                <li key={idx} className="text-blue-100 flex items-start gap-2">
                                  <span className="text-blue-400 mt-1">‚úì</span>
                                  <span>{adv}</span>
                                </li>
                              ))}
                            </ul>
                          </div>
                        </div>

                        <div className="bg-purple-900/30 rounded-xl p-5 border border-purple-500/30 mt-6">
                          <div className="flex items-center gap-2 mb-3">
                            <Target className="text-purple-400" size={24} />
                            <h3 className="text-purple-300 font-bold text-lg">Factores Clave del Partido</h3>
                          </div>
                          <ul className="space-y-2">
                            {analysis.reasoning.keyFactors.map((factor, idx) => (
                              <li key={idx} className="text-purple-100 flex items-start gap-2">
                                <span className="text-purple-400 mt-1">‚ö°</span>
                                <span>{factor}</span>
                              </li>
                            ))}
                          </ul>
                        </div>

                        {/* Datos de forma reciente */}
                        {(analysis.homeStats?.success || analysis.awayStats?.success) && (
                          <div className="grid md:grid-cols-2 gap-6 mt-6">
                            {analysis.homeStats?.success && (
                              <div className="bg-indigo-900/30 rounded-xl p-5 border border-indigo-500/30">
                                <h3 className="text-indigo-300 font-bold text-lg mb-3">üìä Forma {selectedMatch.home}</h3>
                                <div className="space-y-2 text-indigo-100 text-sm">
                                  <p><strong>√öltimos 5:</strong> {analysis.homeStats.recentForm.wins}V / {analysis.homeStats.recentForm.draws}E / {analysis.homeStats.recentForm.losses}D</p>
                                  <p><strong>Goles:</strong> {analysis.homeStats.recentForm.goalsFor} a favor, {analysis.homeStats.recentForm.goalsAgainst} en contra</p>
                                  <p><strong>Como local:</strong> {analysis.homeStats.homeForm.wins}V / {analysis.homeStats.homeForm.draws}E / {analysis.homeStats.homeForm.losses}D</p>
                                </div>
                              </div>
                            )}
                            
                            {analysis.awayStats?.success && (
                              <div className="bg-indigo-900/30 rounded-xl p-5 border border-indigo-500/30">
                                <h3 className="text-indigo-300 font-bold text-lg mb-3">üìä Forma {selectedMatch.away}</h3>
                                <div className="space-y-2 text-indigo-100 text-sm">
                                  <p><strong>√öltimos 5:</strong> {analysis.awayStats.recentForm.wins}V / {analysis.awayStats.recentForm.draws}E / {analysis.awayStats.recentForm.losses}D</p>
                                  <p><strong>Goles:</strong> {analysis.awayStats.recentForm.goalsFor} a favor, {analysis.awayStats.recentForm.goalsAgainst} en contra</p>
                                  <p><strong>Como visitante:</strong> {analysis.awayStats.awayForm.wins}V / {analysis.awayStats.awayForm.draws}E / {analysis.awayStats.awayForm.losses}D</p>
                                </div>
                              </div>
                            )}
                          </div>
                        )}

                        {/* NUEVO: Goles esperados con Poisson */}
                        {analysis.expectedGoals && (
                          <div className="bg-gradient-to-r from-cyan-900/40 to-blue-900/40 rounded-xl p-6 border border-cyan-500/30 mt-6">
                            <h3 className="text-cyan-200 font-bold text-xl mb-4 text-center">üéØ Predicci√≥n de Goles (Modelo Poisson)</h3>
                            
                            <div className="grid grid-cols-3 gap-4 mb-4">
                              <div className="bg-black/30 rounded-lg p-4 text-center">
                                <p className="text-cyan-300 text-sm mb-1">{selectedMatch.home}</p>
                                <p className="text-white text-3xl font-bold">{analysis.expectedGoals.home}</p>
                                <p className="text-cyan-400 text-xs mt-1">goles esperados</p>
                              </div>
                              <div className="bg-black/30 rounded-lg p-4 text-center">
                                <p className="text-cyan-300 text-sm mb-1">Total Partido</p>
                                <p className="text-white text-3xl font-bold">{analysis.expectedGoals.total}</p>
                                <p className="text-cyan-400 text-xs mt-1">goles totales</p>
                              </div>
                              <div className="bg-black/30 rounded-lg p-4 text-center">
                                <p className="text-cyan-300 text-sm mb-1">{selectedMatch.away}</p>
                                <p className="text-white text-3xl font-bold">{analysis.expectedGoals.away}</p>
                                <p className="text-cyan-400 text-xs mt-1">goles esperados</p>
                              </div>
                            </div>
                            
                            <p className="text-cyan-200 text-xs text-center">
                              üìä {analysis.poissonData?.dataSource || 'Calculado con distribuci√≥n de Poisson basada en estad√≠sticas reales de temporada'}
                            </p>
                          </div>
                        )}

                        {/* Probabilidades de goles */}
                        {(analysis.over05 !== undefined || analysis.btts !== undefined) && (
                          <div className="bg-gradient-to-r from-orange-900/40 to-red-900/40 rounded-xl p-6 border border-orange-500/30 mt-6">
                            <h3 className="text-orange-200 font-bold text-xl mb-4 text-center">‚öΩ Probabilidades de Goles {analysis.poissonData ? '(Poisson + Hist√≥rico)' : ''}</h3>
                            
                            <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                              {analysis.over05 !== undefined && (
                                <div className="bg-black/30 rounded-lg p-3 text-center">
                                  <p className="text-orange-300 text-xs mb-1">M√°s 0.5</p>
                                  <p className="text-white text-2xl font-bold">{analysis.over05}%</p>
                                </div>
                              )}
                              {analysis.over15 !== undefined && (
                                <div className="bg-black/30 rounded-lg p-3 text-center">
                                  <p className="text-orange-300 text-xs mb-1">M√°s 1.5</p>
                                  <p className="text-white text-2xl font-bold">{analysis.over15}%</p>
                                </div>
                              )}
                              {analysis.over25 !== undefined && (
                                <div className="bg-black/30 rounded-lg p-3 text-center">
                                  <p className="text-orange-300 text-xs mb-1">M√°s 2.5</p>
                                  <p className="text-white text-2xl font-bold">{analysis.over25}%</p>
                                </div>
                              )}
                              {analysis.over35 !== undefined && (
                                <div className="bg-black/30 rounded-lg p-3 text-center">
                                  <p className="text-orange-300 text-xs mb-1">M√°s 3.5</p>
                                  <p className="text-white text-2xl font-bold">{analysis.over35}%</p>
                                </div>
                              )}
                              {analysis.btts !== undefined && (
                                <div className="bg-black/30 rounded-lg p-3 text-center">
                                  <p className="text-orange-300 text-xs mb-1">Ambos Marcan</p>
                                  <p className="text-white text-2xl font-bold">{analysis.btts}%</p>
                                </div>
                              )}
                            </div>
                            
                            <p className="text-orange-200 text-xs text-center mt-4">
                              Basado en promedio de goles de los √∫ltimos partidos de ambos equipos
                            </p>
                          </div>
                        )}

                        <div className="text-center mt-6">
                          <p className="text-purple-300 text-sm">
                            üí° An√°lisis generado por IA con datos REALES de forma reciente, local/visitante y clasificaci√≥n
                          </p>
                          <p className="text-purple-400 text-xs mt-2">
                            ‚ö†Ô∏è Predicci√≥n estad√≠stica - No garantiza el resultado real del partido
                          </p>
                        </div>
                      </div>
                    ) : null}
                  </div>
                )}
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LaLigaPredictor />);
    </script>
</body>
</html>
